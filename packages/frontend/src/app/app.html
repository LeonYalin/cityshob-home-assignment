<div class="container">
  <header class="header">
    <h1>{{ title() }}</h1>
    <p>Testing Frontend to Backend API Connection with Todos</p>
  </header>

  <main class="main">
    <!-- Loading State -->
    @if (isLoading()) {
      <div class="loading">
        <p>üîÑ Testing API connection...</p>
      </div>
    }

    <!-- Error State -->
    @if (error()) {
      <div class="error">
        <h3>‚ùå Connection Error</h3>
        <p>{{ error() }}</p>
        <button (click)="retryConnection()" class="retry-btn">
          üîÑ Retry Connection
        </button>
      </div>
    }

    <!-- Success State -->
    @if (healthData() && !isLoading()) {
      <div class="success">
        <h3>‚úÖ API Connection Successful!</h3>
        
        <div class="api-results">
          <div class="result-card">
            <h4>Health Check (/api/health)</h4>
            <pre>{{ healthData() | json }}</pre>
          </div>

          <div class="result-card">
            <h4>Todos API (/api/todos)</h4>
            <div class="todos-section">
              <div class="todos-actions">
                <button (click)="createTestTodo()" class="create-btn">
                  ‚ûï Create Test Todo
                </button>
                <button (click)="retryConnection()" class="refresh-btn">
                  üîÑ Refresh Todos
                </button>
              </div>
              
              @if (todos().length > 0) {
                <div class="todos-list">
                  @for (todo of todos(); track todo.id) {
                    <div class="todo-item" [class.completed]="todo.completed">
                      <div class="todo-content">
                        <h5>{{ todo.title }}</h5>
                        <p>{{ todo.description }}</p>
                        <span class="priority priority-{{ todo.priority }}">{{ todo.priority }}</span>
                        <span class="status">{{ todo.completed ? 'Completed' : 'Pending' }}</span>
                      </div>
                      <div class="todo-actions">
                        <button (click)="toggleTodo(todo.id)" class="toggle-btn">
                          {{ todo.completed ? '‚Ü©Ô∏è Undo' : '‚úÖ Complete' }}
                        </button>
                        <button (click)="deleteTodo(todo.id)" class="delete-btn">
                          üóëÔ∏è Delete
                        </button>
                      </div>
                    </div>
                  }
                </div>
              } @else {
                <p class="no-todos">No todos found. Create one to test the API!</p>
              }
            </div>
          </div>
        </div>

        <button (click)="retryConnection()" class="test-btn">
          üß™ Test All APIs Again
        </button>
      </div>
    }
  </main>

  <footer class="footer">
    <p>Backend: <a href="http://localhost:4000" target="_blank">http://localhost:4000</a></p>
    <p>Frontend: <a href="http://localhost:4200" target="_blank">http://localhost:4200</a></p>
  </footer>
</div>

<router-outlet />